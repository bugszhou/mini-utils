{"version":3,"file":"miniapp-utils.common.js","sources":["../src/lib/core/getGlobal.js","../src/lib/core/platform.js","../src/lib/core/updateApp.js","../src/lib/utils/showModal.js"],"sourcesContent":["\nexport default function() {\n  if (typeof wx !== 'undefined' && wx) {\n    return wx;\n  }\n  if (typeof my !== 'undefined' && my) {\n    return my;\n  }\n  if (typeof swan !== 'undefined' && swan) {\n    return swan;\n  }\n  if (typeof tt !== 'undefined' && tt) {\n    return tt;\n  }\n  return global;\n}","\nexport default function getPlatform() {\n  if (typeof wx !== 'undefined' && wx) {\n    return \"weapp\";\n  }\n  if (typeof my !== 'undefined' && my) {\n    return \"aliapp\";\n  }\n  if (typeof swan !== 'undefined' && swan) {\n    return \"swan\";\n  }\n  if (typeof tt !== 'undefined' && tt) {\n    return \"tt\";\n  }\n  throw new Error(`Not Support In This Platform!`);\n}","import getGlobal from \"./getGlobal\";\nimport showModal from \"../utils/showModal\";\n\nconst globalObj = getGlobal();\n\nconst defaultTitle = \"更新提示\";\nconst defaultContent = \"新版本已经准备好，是否重启应用？\";\nconst defaultConfirmText = \"使用新版\";\n\nexport default function updateApp(\n  // eslint-disable-next-line object-curly-newline\n  { reLaunchPage, title, content, confirmText, showCancel } = {\n    reLaunchPage: \"/pages/index/index\",\n    showCancel: false,\n  },\n) {\n  const updateManager = globalObj.getUpdateManager();\n\n  try {\n    updateManager.onCheckForUpdate((res) => {\n      // 是否有更新\n      console.log(res.hasUpdate);\n    });\n\n    updateManager.onUpdateReady(() => {\n      showModal({\n        title: title || defaultTitle,\n        content: content || defaultContent,\n        showCancel,\n        confirmText: confirmText || defaultConfirmText,\n        success({ confirm }) {\n          if (confirm) {\n            updateManager.applyUpdate();\n          }\n        },\n      });\n    });\n\n    updateManager.onUpdateFailed(() => {\n      // 新版本下载失败\n      globalObj.reLaunch({ url: reLaunchPage });\n    });\n  } catch (e) {\n    console.error(e);\n  }\n\n  return updateManager;\n}\n","import getPlatform from '../core/platform';\nimport getGlobal from '../core/getGlobal';\n\nexport default function showModal(opts = {}) {\n  const platform = getPlatform();\n  if (platform === \"aliapp\") {\n    return getGlobal().confirm(opts);\n  }\n  return getGlobal().showModal(opts);\n}\n"],"names":["wx","my","swan","tt","global","getPlatform","Error","globalObj","getGlobal","defaultTitle","defaultContent","defaultConfirmText","reLaunchPage","showCancel","title","content","confirmText","updateManager","getUpdateManager","onCheckForUpdate","res","console","log","hasUpdate","onUpdateReady","opts","confirm","showModal","success","applyUpdate","onUpdateFailed","reLaunch","url","e","error"],"mappings":"oUAEoB,oBAAPA,IAAsBA,GACxBA,GAES,oBAAPC,IAAsBA,GACxBA,GAEW,oBAATC,MAAwBA,KAC1BA,KAES,oBAAPC,IAAsBA,GACxBA,GAEFC,gBCbeC,IACtB,GAAkB,oBAAPL,IAAsBA,GAC/B,MAAO,QAET,GAAkB,oBAAPC,IAAsBA,GAC/B,MAAO,SAET,GAAoB,oBAATC,MAAwBA,KACjC,MAAO,OAET,GAAkB,oBAAPC,IAAsBA,GAC/B,MAAO,KAET,UAAUG,2CCXNC,EAAYC,IAEZC,EAAe,OACfC,EAAiB,mBACjBC,EAAqB,yHAImC,CAC1DC,aAAc,qBACdC,eAFAD,IAAAA,aAAcE,IAAAA,MAAOC,IAAAA,QAASC,IAAAA,YAAaH,IAAAA,WAKvCI,EAAgBV,EAAUW,mBAEhC,IACED,EAAcE,iBAAiB,SAACC,GAE9BC,QAAQC,IAAIF,EAAIG,aAGlBN,EAAcO,cAAc,2BCrBEC,yDAAO,GAEtB,WADApB,IAERG,IAAYkB,QAAQD,GAEtBjB,IAAYmB,UAAUF,GDiBzBE,CAAU,CACRb,MAAOA,GAASL,EAChBM,QAASA,GAAWL,EACpBG,WAAAA,EACAG,YAAaA,GAAeL,EAC5BiB,sBAAUF,SAENT,EAAcY,mBAMtBZ,EAAca,eAAe,WAE3BvB,EAAUwB,SAAS,CAAEC,IAAKpB,MAE5B,MAAOqB,GACPZ,QAAQa,MAAMD,GAGhB,OAAOhB"}