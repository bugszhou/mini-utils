{"version":3,"file":"miniapp-utils.js","sources":["../src/lib/core/getGlobal.js","../src/lib/core/platform.js","../src/lib/utils/showModal.js","../src/lib/core/updateApp.js"],"sourcesContent":["\nexport default function() {\n  if (typeof wx !== 'undefined' && wx) {\n    return wx;\n  }\n  if (typeof my !== 'undefined' && my) {\n    return my;\n  }\n  if (typeof swan !== 'undefined' && swan) {\n    return swan;\n  }\n  if (typeof tt !== 'undefined' && tt) {\n    return tt;\n  }\n  return global;\n}","\nexport default function getPlatform() {\n  if (typeof wx !== 'undefined' && wx) {\n    return \"weapp\";\n  }\n  if (typeof my !== 'undefined' && my) {\n    return \"aliapp\";\n  }\n  if (typeof swan !== 'undefined' && swan) {\n    return \"swan\";\n  }\n  if (typeof tt !== 'undefined' && tt) {\n    return \"tt\";\n  }\n  throw new Error(`Not Support In This Platform!`);\n}","import getPlatform from '../core/platform';\nimport getGlobal from '../core/getGlobal';\n\nexport default function showModal(opts = {}) {\n  const platform = getPlatform();\n  if (platform === \"aliapp\") {\n    return getGlobal().confirm(opts);\n  }\n  return getGlobal().showModal(opts);\n}\n","import getGlobal from \"./getGlobal\";\nimport showModal from \"../utils/showModal\";\n\nconst globalObj = getGlobal();\n\nconst defaultTitle = \"更新提示\";\nconst defaultContent = \"新版本已经准备好，是否重启应用？\";\nconst defaultCconfirmText = \"使用新版\";\n\nexport default function updateApp(\n  // eslint-disable-next-line object-curly-newline\n  { reLaunchPage, title, content, confirmText, showCancel } = {\n    reLaunch: \"/pages/index/index\",\n    showCancel: false,\n  },\n) {\n  const updateManager = globalObj.getUpdateManager();\n\n  try {\n    updateManager.onCheckForUpdate((res) => {\n      // 是否有更新\n      console.log(res.hasUpdate);\n    });\n\n    updateManager.onUpdateReady(() => {\n      showModal({\n        title: title || defaultTitle,\n        content: content || defaultContent,\n        showCancel,\n        confirmText: confirmText || defaultCconfirmText,\n        success({ confirm }) {\n          if (confirm) {\n            updateManager.applyUpdate();\n          }\n        },\n      });\n    });\n\n    updateManager.onUpdateFailed(() => {\n      // 新版本下载失败\n      globalObj.reLaunch({ url: reLaunchPage });\n    });\n  } catch (e) {\n    console.error(e);\n  }\n\n  return updateManager;\n}\n"],"names":["wx","my","swan","tt","global","getPlatform","Error","showModal","opts","platform","getGlobal","confirm","globalObj","defaultTitle","defaultContent","defaultCconfirmText","updateApp","reLaunch","showCancel","reLaunchPage","title","content","confirmText","updateManager","getUpdateManager","onCheckForUpdate","res","console","log","hasUpdate","onUpdateReady","success","applyUpdate","onUpdateFailed","url","e","error"],"mappings":";;;;;;;;;;;sBAC0B,QACN,WAAd,SAAOA,EAAP,EAA6BA,EADT,CAEfA,EAFe,CAIN,WAAd,SAAOC,EAAP,EAA6BA,EAJT,CAKfA,EALe,CAOJ,WAAhB,SAAOC,IAAP,EAA+BA,IAPX,CAQfA,IARe,CAUN,WAAd,SAAOC,EAAP,EAA6BA,EAVT,CAWfA,EAXe,CAajBC,MACR;;WCduBC,WAAT,EAAuB,CACpC,GAAkB,WAAd,SAAOL,EAAP,EAA6BA,EAAjC,CACE,OAAO,OAAP,CAEF,GAAkB,WAAd,SAAOC,EAAP,EAA6BA,EAAjC,CACE,OAAO,QAAP,CAEF,GAAoB,WAAhB,SAAOC,IAAP,EAA+BA,IAAnC,CACE,OAAO,MAAP,CAEF,GAAkB,WAAd,SAAOC,EAAP,EAA6BA,EAAjC,CACE,OAAO,IAAP,CAEF,UAAUG,KAAJ,iCACP;;WCZuBC,SAAT,EAA8B,KAAXC,IAAW,wDAAJ,EAAI,CACrCC,QAAQ,CAAGJ,WAAW,EADe,QAE1B,QAAb,GAAAI,QAFuC,CAGlCC,SAAS,GAAGC,OAAZ,CAAoBH,IAApB,CAHkC,CAKpCE,SAAS,GAAGH,SAAZ,CAAsBC,IAAtB,CACR;;MCNKI,SAAS,CAAGF,SAAS,GAErBG,YAAY,CAAG,2BACfC,cAAc,CAAG,mGACjBC,mBAAmB,CAAG,2BAE5B,SAAwBC,SAAT,EAMb,iEAJ4D,CAC1DC,QAAQ,CAAE,oBADgD,CAE1DC,UAAU,GAFgD,CAI5D,CAJEC,YAIF,MAJEA,YAIF,CAJgBC,KAIhB,MAJgBA,KAIhB,CAJuBC,OAIvB,MAJuBA,OAIvB,CAJgCC,WAIhC,MAJgCA,WAIhC,CAJ6CJ,UAI7C,MAJ6CA,UAI7C,CACMK,aAAa,CAAGX,SAAS,CAACY,gBAAV,EADtB,CAGA,GAAI,CACFD,aAAa,CAACE,gBAAd,CAA+B,SAACC,GAAD,CAAS,CAEtCC,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACG,SAAhB,EACD,CAHD,CADE,CAMFN,aAAa,CAACO,aAAd,CAA4B,UAAM,CAChCvB,SAAS,CAAC,CACRa,KAAK,CAAEA,KAAK,EAAIP,YADR,CAERQ,OAAO,CAAEA,OAAO,EAAIP,cAFZ,CAGRI,UAAU,CAAVA,UAHQ,CAIRI,WAAW,CAAEA,WAAW,EAAIP,mBAJpB,CAKRgB,OALQ,wBAKa,KAAXpB,OAAW,OAAXA,OAAW,CACfA,OADe,EAEjBY,aAAa,CAACS,WAAd,GAEH,CATO,CAAD,EAWV,CAZD,CANE,CAoBFT,aAAa,CAACU,cAAd,CAA6B,UAAM,CAEjCrB,SAAS,CAACK,QAAV,CAAmB,CAAEiB,GAAG,CAAEf,YAAP,CAAnB,EACD,CAHD,EAID,CAAC,MAAOgB,CAAP,CAAU,CACVR,OAAO,CAACS,KAAR,CAAcD,CAAd,EACD,CAED,OAAOZ,aACR;;;;;;;;;;;;;;"}